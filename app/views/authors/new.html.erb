<%= link_to 'Back', root_path %>

<ul>
    <li>The view <em>/view/books/index</em> calls for the view <em>/views/authors/new</em>.
    The variables that feed this form, <em>@author = Author.new</em> and <em>@author.books.build</em>,
    are thus initialized in the method <em>books#index</em>. 
    </li>
    <li>If we specify <em>url: books_path</em> in the form definition, then Rails will call the method 
    books#create and use <em>form action="/books" method="post"</em>. 
            
    </li>
    <li>If we don't specify it, since this partial is located in '/views/authors', then 
    Rails will use <em>authors_path</em> and use <em>authors#create</em>, so will put <em>form action="authors" method="post"</em>
    and call for the method <em>authors#create</em>.
    </li>
</ul>

<div class="container">
    <div class="row">
        <% if @author.errors.any? %>
            <h5 ><%= pluralize(@author.errors.count, "error") %> prohibited this post from being saved:</h5>
            <ul>
                <% @author.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                <% end %>
            </ul>
        <% end %>
    </div>

    <div class="row">
    
<!-- le 'submit' actionne authors#create <-> authors_path d'ou l'url-->
        <%= simple_form_for @author, url: authors_path do |f| %>
            <legend>Create an author</legend>
        <div class="row border d-flex flex-row justify-content-between align-items-center">         
            <%= f.error_notification %>
            <div class="col-sm-8 col-md-8">
    <!--  '.input_field' removes the div around -->
                <%= f.input_field :name, placeholder: "Author's name",
                    class: "input-author" %>
    <!-- !! with 'input_field', we must use 'class: ...' without 'thml_input-->
            </div>
            <div class="col-sm-4 col-md-4">
                <%= f.association :country, prompt: "Select a country", label: false, 
                    input_html: { class: "form-control" } %>
            </div>

        <%# # https://api.rubyonrails.org/v5.1/classes/ActionView/Helpers/FormTagHelper.html#method-i-hidden_field_tag %>
                <%= f.input :id, as: :hidden, value: @author.object_id  %>
        </div>
<!-- https://github.com/heartcombo/simple_form/wiki/Nested-Models> -->    
        <br>
    
         
        <div class="row border pl-2 pr-3" >
            <p>Create associated books</p>
            <div class="row d-flex">
                 
                <%= f.simple_fields_for(:books, :genre)  do |b| %>   
                    <%= render 'authors/bookfields', ff:b, genres: @genres %>
                <% end %>
                
            </div>   
        </div>
    
                
        <div class="row p-2">
            <%= f.submit "Create author & books", class:"btn btn-primary"%> 
        </div>
        
        <% end %>
    </div>
    
    <div class="row border p-2" id="new-genre" >
    <!-- !! with 'form.input', we must use 'input_html: {class:..}' -->
        <%= simple_form_for @genre, url: '/genres', remote: true,
                wrapper: :inline_form, html: { class: "form-inline" } do |b| %>

            <%= b.input :name, placeholder: "Enter a new genre?",
                input_html: { class: "ml-3 mt-2 p-2 input-author", id: "newgenre" } %>

            <%= b.submit "Create", class:"btn-success ml-4 pl-3 pr-3 mt-2 input-author"  %>
        
        <% end %>
    </div>
</div>